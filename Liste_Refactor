# DÃ©finir les paramÃ¨tres
$logName = "Security"
$eventID_Success = 4624  # Connexion rÃ©ussie
$eventID_Failed  = 4625  # Connexion Ã©chouÃ©e
$username = "Administrateur"

# DÃ©finir la pÃ©riode de recherche (YYYY-MM-DD HH:mm:ss)
$dateDebut = Get-Date "2025-02-06 12:00:00"
$dateFin   = Get-Date "2025-02-06 15:00:59"

# Fonction pour traduire le LogonType en texte
function Get-LogonTypeText($logonType) {
    switch ($logonType) {
        2  { "Session Locale (Interactive)" }
        3  { "RÃ©seau (SMB, Partageâ€¦)" }
        4  { "TÃ¢che planifiÃ©e" }
        5  { "Service" }
        7  { "DÃ©verrouillage de session" }
        8  { "RÃ©seau clair (Cleartext)" }
        9  { "Session Nouvelle (Terminal Services)" }
        10 { "Bureau Ã  distance (RDP)" }
        11 { "Connexion via Cached Credentials" }
        default { "Inconnu ($logonType)" }
    }
}

# Fonction pour traduire les motifs d'Ã©chec
function Get-FailureReason($status) {
    switch ($status) {
        "0xC000006A" { "Mot de passe incorrect" }
        "0xC000006D" { "Nom d'utilisateur inconnu" }
        "0xC000006F" { "Mot de passe expirÃ©" }
        "0xC0000070" { "Compte restreint" }
        "0xC0000071" { "Compte dÃ©sactivÃ©" }
        "0xC0000224" { "Doit changer le mot de passe" }
        "0xC0000234" { "Compte verrouillÃ©" }
        default { "Erreur inconnue ($status)" }
    }
}

# Filtrage optimisÃ© pour rÃ©cupÃ©rer connexions rÃ©ussies et Ã©chouÃ©es
$filter_Success = @{
    LogName   = $logName
    ID        = $eventID_Success
    StartTime = $dateDebut
    EndTime   = $dateFin
}
$filter_Failed = @{
    LogName   = $logName
    ID        = $eventID_Failed
    StartTime = $dateDebut
    EndTime   = $dateFin
}

# RÃ©cupÃ©ration des logs
$logins_Success = Get-WinEvent -FilterHashtable $filter_Success -ErrorAction SilentlyContinue | Where-Object {
    $_.Properties[5].Value -eq $username
}

$logins_Failed = Get-WinEvent -FilterHashtable $filter_Failed -ErrorAction SilentlyContinue | Where-Object {
    $_.Properties[5].Value -eq $username
}

# Affichage formatÃ© avec colonnes bien alignÃ©es (IPV6 prise en charge)
if ($logins_Success -or $logins_Failed) {
    $border = "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
    $header = "â•‘ Date et Heure             â•‘ Utilisateur       â•‘ Domaine   â•‘ Type de Connexion             â•‘ IP                                 â•‘ Statut                â•‘"
    $separator1 = "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
    $separator = "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"

    Write-Host "`n$border" -ForegroundColor Cyan
    Write-Host "                                ğŸ” Connexions rÃ©ussies et Ã©chouÃ©es pour '$username'" -ForegroundColor Cyan
    Write-Host "$separator1" -ForegroundColor Cyan
    Write-Host "$header" -ForegroundColor Cyan
    Write-Host "$separator" -ForegroundColor Cyan

    # Affichage des connexions rÃ©ussies
    $logins_Success | ForEach-Object {
        $time = $_.TimeCreated.ToString("yyyy-MM-dd HH:mm:ss")
        $user = $_.Properties[5].Value
        $domain = $_.Properties[6].Value
        $logonType = Get-LogonTypeText $_.Properties[8].Value
        $ip = $_.Properties[18].Value

        Write-Host ("â•‘ {0,-25} â•‘ {1,-17} â•‘ {2,-9} â•‘ {3,-29} â•‘ {4,-34} â•‘ âœ… RÃ©ussie           â•‘" -f $time, $user, $domain, $logonType, $ip) -ForegroundColor Green
    }

    # Affichage des connexions Ã©chouÃ©es
    $logins_Failed | ForEach-Object {
        $time = $_.TimeCreated.ToString("yyyy-MM-dd HH:mm:ss")
        $user = $_.Properties[5].Value
        $domain = $_.Properties[6].Value
        $logonType = Get-LogonTypeText $_.Properties[8].Value
        $ip = $_.Properties[18].Value
        $status = $_.Properties[7].Value
        $failureReason = Get-FailureReason $status

        Write-Host ("â•‘ {0,-25} â•‘ {1,-17} â•‘ {2,-9} â•‘ {3,-29} â•‘ {4,-34} â•‘ âŒ {5,-17} â•‘" -f $time, $user, $domain, $logonType, $ip, $failureReason) -ForegroundColor Red
    }

    Write-Host "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•`n" -ForegroundColor Cyan
} else {
    Write-Host "`nâŒ Aucune connexion rÃ©ussie ou Ã©chouÃ©e trouvÃ©e pour '$username' entre $dateDebut et $dateFin." -ForegroundColor Red
}
